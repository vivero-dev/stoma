---
title: Installation
description: Install Stoma and configure your TypeScript project for any runtime.
draft: false
sidebar:
  order: 1
---

import { Tabs, TabItem } from "@astrojs/starlight/components";

## Install the package

Stoma requires **Hono v4.x or later** as a peer dependency. Install both together:

<Tabs>
  <TabItem label="npm">
    ```sh
    npm install @vivero/stoma hono
    ```
  </TabItem>
  <TabItem label="yarn">
    ```sh
    yarn add @vivero/stoma hono
    ```
  </TabItem>
  <TabItem label="pnpm">
    ```sh
    pnpm add @vivero/stoma hono
    ```
  </TabItem>
</Tabs>

## Optional dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| `hono` | `>=4.0` | **Required** peer dependency. Provides the router, context, and middleware system. |
| `zod` | `>=3.0` | **Optional**. Enables config schema validation at construction time. |

If you want Zod-based config validation:

<Tabs>
  <TabItem label="npm">
    ```sh
    npm install zod
    ```
  </TabItem>
  <TabItem label="yarn">
    ```sh
    yarn add zod
    ```
  </TabItem>
  <TabItem label="pnpm">
    ```sh
    pnpm add zod
    ```
  </TabItem>
</Tabs>

## TypeScript configuration

Stoma is written in TypeScript and exports raw `.ts` source files directly -- there
is no build step. Your bundler (Vite, esbuild, wrangler) compiles the TypeScript at
build time alongside your own code.

Your `tsconfig.json` should use these settings at minimum:

```json
{
  "compilerOptions": {
    // Target ES2022 or later - Stoma uses modern APIs:
    // - structuredClone() for cloning request/response objects
    // - AbortSignal.timeout() for timeout handling
    // - crypto.subtle for JWT signing/verification
    // All available in Cloudflare Workers, Deno, Bun, Node 20+
    "target": "ES2022",

    // Use ESNext modules (modern JavaScript module system)
    // This matches how bundlers like Vite, esbuild, and wrangler work
    "module": "ESNext",

    // Required for subpath exports to resolve correctly
    // Allows @vivero/stoma/policies, @vivero/stoma/config, etc.
    "moduleResolution": "bundler",

    // Enable all strict type checking
    // Stoma's types are authored with strict mode - you'll get the best experience
    "strict": true,

    // Interop with CommonJS modules (some dependencies may use CommonJS)
    "esModuleInterop": true,

    // Skip type checking of declaration files (reduces build time)
    // You can set to false if you need perfect type coverage
    "skipLibCheck": true
  }
}
```

Key requirements:

- **`target: "ES2022"`** or later. Stoma uses `structuredClone`, `AbortSignal.timeout`,
  `crypto.subtle`, and other modern APIs. These are available natively in Cloudflare
  Workers, Deno, Bun, and Node.js 20+.
- **`moduleResolution: "bundler"`**. Required for subpath exports
  (`@vivero/stoma/policies`, `@vivero/stoma/config`) to resolve
  correctly.
- **`strict: true`**. Recommended. Stoma's types are authored with strict mode enabled.

## Subpath exports

The package exposes five entry points:

| Import path | Contents |
|-------------|----------|
| `@vivero/stoma` | Main entry: `createGateway`, all built-in policies, SDK helpers, all types |
| `@vivero/stoma/policies` | Policy factory functions, SDK helpers, and policy types only |
| `@vivero/stoma/config` | Config type re-exports + Zod validation schemas (`validateConfig`, `safeValidateConfig`, `GatewayConfigSchema`) |
| `@vivero/stoma/sdk` | Policy SDK: `definePolicy()`, `createPolicyTestHarness()`, `Priority` constants, `resolveConfig`, `policyDebug`, `withSkip` |
| `@vivero/stoma/adapters` | Cloudflare-specific adapters (KV, Durable Objects) |

For most use cases, import everything from the main entry point:

```typescript
// The main entry point includes everything you need for most use cases:
// - createGateway: The core function to build your gateway
// - All built-in policies: jwtAuth, rateLimit, cors, requestLog, etc.
// - SDK helpers: definePolicy, Priority, withSkip, etc.
// - All types: GatewayConfig, RouteConfig, PolicyContext, etc.
import { createGateway, jwtAuth, rateLimit, cors } from "@vivero/stoma";
```

For custom policy development, import the SDK directly:

```typescript
// The SDK provides building blocks for authoring custom policies:
/*
  definePolicy: Creates a policy factory function with defaults, priority, etc.
  Priority: Named constants for policy execution order (Priority.AUTH, Priority.CACHE, etc.)
  createPolicyTestHarness: Test your policy in isolation without a full gateway
  resolveConfig: Deep-merge default config with user overrides
  policyDebug: Namespaced debug logger with zero overhead when disabled
  withSkip: Conditionally disable a policy based on request characteristics
*/
import { definePolicy, Priority, createPolicyTestHarness } from "@vivero/stoma/sdk";
```

## Runtime-specific setup

Stoma runs on any JavaScript runtime that supports Web Standard APIs. The core library has no
runtime-specific dependencies. Additional setup depends on where you deploy.

### Cloudflare Workers

Install the Workers type definitions as a dev dependency:

```sh
npm install -D @cloudflare/workers-types
```

Add them to your `tsconfig.json`:

```json
{
  "compilerOptions": {
    "types": ["@cloudflare/workers-types"]
  }
}
```

This enables typed access to `c.env` bindings (secrets, Service Bindings, KV
namespaces). The `@vivero/stoma/adapters` subpath export provides
Cloudflare-specific stores for rate limiting (KV, Durable Objects) and circuit
breakers.

### Node.js

Install the Hono Node.js adapter:

```sh
npm install @hono/node-server
```

Then serve the gateway app:

```typescript
import { serve } from "@hono/node-server";
serve({ fetch: gateway.app.fetch, port: 3000 });
```

### Deno and Bun

No additional dependencies are needed. Export or serve the `gateway.app`
directly using the runtime's native APIs. See the
[Quick Start](/getting-started/quick-start/) for examples.

## Next steps

With the package installed, proceed to the [Quick Start](/getting-started/quick-start/)
to define your first gateway.
